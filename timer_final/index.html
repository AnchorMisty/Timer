<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>timer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow: hidden;
            position: relative;
        }

        /* è®¡æ—¶å™¨å®¹å™¨ */
        .timer-container {
            text-align: center;
            z-index: 1;
            transition: transform 0.8s ease;
        }

        .timer-container.moved-up {
            transform: translateY(-40vh);
        }

        .timer-display {
            font-size: 72px;
            font-weight: bold;
            color: white;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
            font-variant-numeric: tabular-nums;
        }

        .control-button {
            padding: 15px 40px;
            font-size: 20px;
            font-weight: bold;
            color: white;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .control-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .control-button:active {
            transform: scale(0.98);
        }

        /* ==================== æ¡Œå® åŒºåŸŸ ==================== */
        
        /* æ¡Œå® å®¹å™¨ */
        .pet-container {
            position: fixed;
            cursor: grab;
            user-select: none;
            z-index: 1000;
            touch-action: none;
            transition: opacity 0.3s ease;
        }

        .pet-container.dragging {
            cursor: grabbing;
        }

        .pet-container.hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* æ¡Œå® è§’è‰²å›¾ç‰‡ */
        .pet-sprite {
            width: 150px;
            height: 150px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            position: relative;
        }

        /* é»˜è®¤å ä½ç¬¦ï¼ˆå¦‚æœæ²¡æœ‰å›¾ç‰‡ï¼‰ */
        .pet-placeholder {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            border-radius: 50%;
            position: relative;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            animation: float 3s ease-in-out infinite;
        }

        .pet-eye {
            position: absolute;
            width: 15px;
            height: 15px;
            background: #2d3436;
            border-radius: 50%;
            top: 45px;
            animation: blink 4s infinite;
        }

        .pet-eye.left { left: 35px; }
        .pet-eye.right { right: 35px; }

        .pet-mouth {
            position: absolute;
            width: 30px;
            height: 15px;
            border: 3px solid #2d3436;
            border-top: none;
            border-radius: 0 0 30px 30px;
            bottom: 35px;
            left: 50%;
            transform: translateX(-50%);
        }

        /* è¯­å½•æ°”æ³¡ï¼ˆæ‹–åŠ¨æ—¶ï¼‰ */
        .speech-bubble {
            position: absolute;
            bottom: 160px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 15px 20px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            max-width: 350px;
            min-width: 190px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 10;
        }

        .speech-bubble.show {
            opacity: 1;
        }

        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid white;
        }

        .speech-text {
            color: #2d3436;
            font-size: 16px;
            line-height: 1.4;
        }

        /* ==================== ç»“æŸå±•ç¤ºåŒºåŸŸ ==================== */
        
        /* ç»“æŸå±•ç¤ºå®¹å™¨ */
        .end-display {
            position: fixed;
            bottom: -100%;
            left: 0;
            right: 0;
            height: 60vh;
            background: linear-gradient(to top, rgba(255, 255, 255, 0.95), transparent);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            padding-bottom: 30px;
            transition: bottom 0.8s ease;
            z-index: 999;
        }

        .end-display.show {
            bottom: 0;
        }

        /* ç«‹ç»˜å®¹å™¨ */
        .character-portrait {
            width: 400px;
            height: 500px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center bottom;
            margin-bottom: 20px;
            animation: portraitAppear 0.8s ease;
        }

        /* é»˜è®¤ç«‹ç»˜å ä½ç¬¦ */
        .portrait-placeholder {
            width: 200px;
            height: 200px;
            background: linear-gradient(135deg, #74b9ff, #a29bfe);
            border-radius: 50%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        /* è¯„ä»·å¯¹è¯æ¡† */
        .comment-box {
            background: white;
            padding: 25px 30px;
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 90%;
            text-align: center;
            animation: commentAppear 0.8s ease 0.3s both;
        }

        .comment-text {
            color: #2d3436;
            font-size: 20px;
            line-height: 1.6;
            font-weight: bold;
        }

        .time-info {
            color: #636e72;
            font-size: 16px;
            margin-top: 10px;
        }

        .close-button {
            margin-top: 20px;
            padding: 10px 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .close-button:hover {
            transform: scale(1.05);
        }

        /* ==================== èŠå¤©æŒ‰é’® ==================== */

        .chat-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 28px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .chat-button:active {
            transform: scale(0.95);
        }

        /* é€‰é¡¹æŒ‰é’®å®¹å™¨ */
        .options-container {
            position: fixed;           
            bottom: 90px;              
            right: 20px;               
            left: auto;                
            transform: none;           
            display: flex;
            flex-direction: column;  
            gap: 10px;
            flex-wrap: nowrap;         
            align-items: flex-end;    
            max-width: 250px;        
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, bottom 0.3s ease;
            z-index: 1002;
        }

        .options-container.show {
            opacity: 1;
            pointer-events: auto;
            bottom: 90px;             
        }

        /* å•ä¸ªé€‰é¡¹æŒ‰é’® */
        .option-button {
            padding: 8px 16px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
        }

        .option-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .option-button:active {
            transform: translateY(0);
        }

        /* æ‰‹æœºé€‚é… */
        @media (max-width: 600px) {
            .chat-button {
                width: 50px;
                height: 50px;
                font-size: 24px;
                bottom: 15px;
                right: 15px;
            }

            .options-container {
                bottom: 75px;          
                right: 15px;          
                max-width: 200px;
            }

            .options-container.show {
                bottom: 75px;
            }
        }

        /* ==================== åŠ¨ç”» ==================== */
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        @keyframes blink {
            0%, 48%, 52%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(0.1); }
        }

        @keyframes portraitAppear {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes commentAppear {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ==================== æ‰‹æœºé€‚é… ==================== */
        
        @media (max-width: 600px) {
            .timer-display {
                font-size: 56px;
            }

            .control-button {
                padding: 12px 30px;
                font-size: 18px;
            }

            .pet-sprite {
                width: 150px;
                height: 150px;
            }

            .pet-placeholder {
                width: 100px;
                height: 100px;
            }

            .pet-eye {
                width: 12px;
                height: 12px;
                top: 38px;
            }

            .pet-eye.left { left: 28px; }
            .pet-eye.right { right: 28px; }

            .pet-mouth {
                width: 25px;
                height: 12px;
                bottom: 30px;
            }

            .speech-bubble {
                bottom: 130px;
                max-width: 300px;
                min-width: 180px;
                padding: 12px 16px;
            }

            .speech-text {
                font-size: 14px;
            }

            .character-portrait {
                width: 400px;
                height: 500px;
            }

            .portrait-placeholder {
                width: 400px;
                height: 500px;
            }

            .comment-box {
                padding: 20px 25px;
            }

            .comment-text {
                font-size: 18px;
            }

            .time-info {
                font-size: 14px;
            }
        }
    </style>
</head>

<!-- èŠå¤©æŒ‰é’® -->
    <button class="chat-button" id="chatButton">ğŸ’¬</button>

</body>

<body>
    <!-- è®¡æ—¶å™¨åŒºåŸŸ -->
    <div class="timer-container" id="timerContainer">
        <div class="timer-display" id="timerDisplay">00:00:00</div>
        <button class="control-button" id="controlButton">START</button>
    </div>

    <!-- æ¡Œå® åŒºåŸŸ -->
    <div class="pet-container" id="petContainer">
        <div class="speech-bubble" id="speechBubble">
            <div class="speech-text" id="speechText"></div>
        </div>
        <!-- è¿™é‡Œä¼šåŠ¨æ€æ’å…¥æ¡Œå®  -->
        <div id="petSprite"></div>
    </div>

    <!-- ç»“æŸå±•ç¤ºåŒºåŸŸ -->
    <div class="end-display" id="endDisplay">
        <!-- è¿™é‡Œä¼šåŠ¨æ€æ’å…¥ç«‹ç»˜ -->
        <div id="characterPortrait"></div>
        <div class="comment-box">
            <div class="comment-text" id="commentText"></div>
            <div class="time-info" id="timeInfo"></div>
            <button class="close-button" id="closeButton">BACK</button>
        </div>
    </div>

    <script>
        // ==================== å›¾ç‰‡é…ç½®åŒºåŸŸ ====================
        // åœ¨è¿™é‡Œè®¾ç½®ä½ çš„è‡ªå®šä¹‰å›¾ç‰‡è·¯å¾„ï¼
        
        const IMAGES = {
            // å¾…æœºåŠ¨ç”»å¸§åºåˆ—ï¼ˆä¼šè‡ªåŠ¨å¾ªç¯æ’­æ”¾ï¼‰
            idleFrames: [
                 'images/idle1.png',
                 'images/idle1.png',
                 'images/idle1.png',
                 'images/idle1.png',
                 'images/idle1.png',

                 'images/idle2.png',
                 'images/idle3.png',

                 'images/idle4.png',
                 'images/idle4.png',
                 'images/idle4.png',
                 'images/idle4.png',
                 'images/idle4.png',

                 'images/idle3.png',
                 'images/idle2.png',
            ],
            
            // æ‹–åŠ¨æ—¶çš„åŠ¨ç”»å¸§åºåˆ—
            dragFrames: [
                 'images/up1.png',
                // 'images/drag_2.png',
                // 'images/drag_3.png',
            ],
            
            // ç»“æŸæ—¶çš„ç«‹ç»˜ï¼ˆå¯ä»¥æ˜¯å¤šå¼ ï¼Œéšæœºé€‰æ‹©ï¼‰
            portraits: [
                 'images/standing.png',
                // 'images/portrait_2.png',
                // 'images/portrait_happy.png',
            ]
        };

        // åŠ¨ç”»å¸§ç‡è®¾ç½®ï¼ˆæ¯«ç§’ï¼‰
        const ANIMATION_CONFIG = {
            idleFrameRate: 200,    // å¾…æœºåŠ¨ç”»æ¯å¸§é—´éš”
            dragFrameRate: 150,    // æ‹–åŠ¨åŠ¨ç”»æ¯å¸§é—´éš”
        };

        // ==================== è¯­å½•é…ç½®åŒºåŸŸ ====================
        
        const startQuotes = [
            "Let's go baby, I'll be with you!",
            "Let's start together",
            "Finally! I thought you would never do it",
            "It's starting!",
            "Yess!",
            "I'm here with you",
            "Great!"
        ];

        const dragQuotes = [
            "What the hell are you doing?",
            "How do you know you can do this?",
            "Why do this to me?!",
            "I'm dizzy!",
            "Leave me alone!",
            "It's tooo high!!"
        ];

        const endComments = {
            short: [
                "Really? Only this?",
                "Did you even start?",
                "Okay, if you want",
                "Maybe longer next time."
            ],
            medium: [
                "Good start babyy",
                "Just so so",
                "Talk to me now!",
                "Are you sure you don't what more?",
                "How do you feel?"
            ],
            good: [
                "Wow, great, really.",
                "I feel lonely when you're not here",
                "It's time to find something else to do",
                "Maybe you cheated... Just saying",
                "I'm really proud of you baby"
            ],
            excellent: [
                "What? You cheated! No?",
                "Oh my god, you really did it",
                "How could you do this? Awesome!",
                "I gave up, you're too good at this",
                "Are you wait for me?"
            ]
        };

        // ==================== è®¡æ—¶å™¨é€»è¾‘ ====================
        
        let isRunning = false;
        let startTime = null;
        let timerInterval = null;

        const timerDisplay = document.getElementById('timerDisplay');
        const controlButton = document.getElementById('controlButton');
        const timerContainer = document.getElementById('timerContainer');
        const speechBubble = document.getElementById('speechBubble');
        const speechText = document.getElementById('speechText');
        const endDisplay = document.getElementById('endDisplay');
        const commentText = document.getElementById('commentText');
        const timeInfo = document.getElementById('timeInfo');
        const closeButton = document.getElementById('closeButton');

        function formatTime(seconds) {
            const hrs = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${String(hrs).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        function updateTimer() {
            const currentTime = Date.now();
            const elapsedSeconds = Math.floor((currentTime - startTime) / 1000);
            timerDisplay.textContent = formatTime(elapsedSeconds);
        }

        function showQuote(text) {
            speechText.textContent = text;
            speechBubble.classList.add('show');
            setTimeout(() => {
                speechBubble.classList.remove('show');
            }, 4000);
        }

        function getRandomQuote(quotesArray) {
            return quotesArray[Math.floor(Math.random() * quotesArray.length)];
        }

        function getCommentByDuration(seconds) {
            const minutes = seconds / 60;
            if (minutes < 1) return getRandomQuote(endComments.short);
            else if (minutes < 30) return getRandomQuote(endComments.medium);
            else if (minutes < 60) return getRandomQuote(endComments.good);
            else return getRandomQuote(endComments.excellent);
        }

        function startTimer() {
            isRunning = true;
            startTime = Date.now();
            controlButton.textContent = 'END';
            showQuote(getRandomQuote(startQuotes));
            timerInterval = setInterval(updateTimer, 1000);
            updateTimer();
        }

        function stopTimer() {
            isRunning = false;
            clearInterval(timerInterval);
            
            const elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
            controlButton.textContent = 'START';
            
            showEndDisplay(elapsedSeconds);
        }

        function showEndDisplay(elapsedSeconds) {
            // éšè—æ¡Œå® 
            petContainer.classList.add('hidden');
            
            // è®¡æ—¶å™¨ä¸Šç§»
            timerContainer.classList.add('moved-up');
            
            // æ˜¾ç¤ºç»“æŸå±•ç¤º
            setTimeout(() => {
                const comment = getCommentByDuration(elapsedSeconds);
                commentText.textContent = comment;
                timeInfo.textContent = `DURATIONï¼š${formatTime(elapsedSeconds)}`;
                
                // è®¾ç½®ç«‹ç»˜
                setupPortrait();
                
                endDisplay.classList.add('show');
            }, 400);
        }

        function hideEndDisplay() {
            endDisplay.classList.remove('show');
            timerContainer.classList.remove('moved-up');
            
            // æ˜¾ç¤ºæ¡Œå® 
            setTimeout(() => {
                petContainer.classList.remove('hidden');
            }, 400);
            
            setTimeout(() => {
                timerDisplay.textContent = '00:00:00';
            }, 800);
        }

        closeButton.addEventListener('click', hideEndDisplay);

        controlButton.addEventListener('click', () => {
            if (isRunning) {
                stopTimer();
            } else {
                // å¦‚æœåœ¨ç«‹ç»˜å±•ç¤ºçŠ¶æ€ï¼Œå…ˆå…³é—­å®ƒ
                if (endDisplay.classList.contains('show')) {
                    hideEndDisplay();
                }
                startTimer();
            }
        });

        // ==================== æ¡Œå® åŠ¨ç”»ç³»ç»Ÿ ====================
        
        let currentIdleFrame = 0;
        let currentDragFrame = 0;
        let idleAnimationInterval = null;
        let dragAnimationInterval = null;

        function setupPetSprite() {
            const petSprite = document.getElementById('petSprite');
            
            if (IMAGES.idleFrames.length > 0) {
                // ä½¿ç”¨è‡ªå®šä¹‰å›¾ç‰‡
                petSprite.className = 'pet-sprite';
                petSprite.style.backgroundImage = `url('${IMAGES.idleFrames[0]}')`;
                startIdleAnimation();
            } else {
                // ä½¿ç”¨é»˜è®¤å ä½ç¬¦
                petSprite.innerHTML = `
                    <div class="pet-placeholder">
                        <div class="pet-eye left"></div>
                        <div class="pet-eye right"></div>
                        <div class="pet-mouth"></div>
                    </div>
                `;
            }
        }

        function startIdleAnimation() {
            if (IMAGES.idleFrames.length <= 1) return;
            
            stopDragAnimation();
            idleAnimationInterval = setInterval(() => {
                currentIdleFrame = (currentIdleFrame + 1) % IMAGES.idleFrames.length;
                document.getElementById('petSprite').style.backgroundImage = 
                    `url('${IMAGES.idleFrames[currentIdleFrame]}')`;
            }, ANIMATION_CONFIG.idleFrameRate);
        }

        function startDragAnimation() {
            if (IMAGES.dragFrames.length === 0) return;
            
            stopIdleAnimation();
            
            const petSprite = document.getElementById('petSprite');
            petSprite.style.backgroundImage = `url('${IMAGES.dragFrames[0]}')`;
            
            if (IMAGES.dragFrames.length > 1) {
                dragAnimationInterval = setInterval(() => {
                    currentDragFrame = (currentDragFrame + 1) % IMAGES.dragFrames.length;
                    petSprite.style.backgroundImage = 
                        `url('${IMAGES.dragFrames[currentDragFrame]}')`;
                }, ANIMATION_CONFIG.dragFrameRate);
            }
        }

        function stopIdleAnimation() {
            if (idleAnimationInterval) {
                clearInterval(idleAnimationInterval);
                idleAnimationInterval = null;
            }
        }

        function stopDragAnimation() {
            if (dragAnimationInterval) {
                clearInterval(dragAnimationInterval);
                dragAnimationInterval = null;
            }
        }

        function setupPortrait() {
            const portraitDiv = document.getElementById('characterPortrait');
            
            if (IMAGES.portraits.length > 0) {
                const randomPortrait = IMAGES.portraits[
                    Math.floor(Math.random() * IMAGES.portraits.length)
                ];
                portraitDiv.className = 'character-portrait';
                portraitDiv.style.backgroundImage = `url('${randomPortrait}')`;
            } else {
                portraitDiv.innerHTML = '<div class="portrait-placeholder"></div>';
            }
        }

        // ==================== æ‹–åŠ¨ä¸é‡åŠ›ç³»ç»Ÿ ====================
        
        const petContainer = document.getElementById('petContainer');
        let isDragging = false;
        let dragOffsetX = 0;
        let dragOffsetY = 0;
        let petX = window.innerWidth / 2;
        let petY = window.innerHeight - 100;

        // åˆå§‹åŒ–æ¡Œå® ä½ç½®
        function initPetPosition() {
            petX = window.innerWidth / 2;
            petY = window.innerHeight - 100;
            updatePetPosition();
        }

        function updatePetPosition() {
            petContainer.style.left = petX + 'px';
            petContainer.style.top = petY + 'px';
            petContainer.style.transform = 'translate(-50%, -50%)';
        }

        petContainer.addEventListener('mousedown', dragStart);
        petContainer.addEventListener('touchstart', dragStart);
        document.addEventListener('mousemove', drag);
        document.addEventListener('touchmove', drag);
        document.addEventListener('mouseup', dragEnd);
        document.addEventListener('touchend', dragEnd);

        function dragStart(e) {
            e.preventDefault();
            
            const clientX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
            const clientY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
            
            // è®¡ç®—é¼ æ ‡ç›¸å¯¹äºæ¡Œå® ä¸­å¿ƒçš„åç§»
            dragOffsetX = clientX - petX;
            dragOffsetY = clientY - petY;

            isDragging = true;
            petContainer.classList.add('dragging');
            
            // åˆ‡æ¢åˆ°æ‹–åŠ¨åŠ¨ç”»
            startDragAnimation();
            showQuote(getRandomQuote(dragQuotes));
        }

        function drag(e) {
            if (!isDragging) return;
            e.preventDefault();

            const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
            const clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;

            // ç›´æ¥è·Ÿéšé¼ æ ‡/æ‰‹æŒ‡
            petX = clientX - dragOffsetX;
            petY = clientY - dragOffsetY;

            updatePetPosition();
        }

        function dragEnd(e) {
            if (!isDragging) return;
            
            isDragging = false;
            petContainer.classList.remove('dragging');
            
            // é‡åŠ›å è½åˆ°åº•éƒ¨
            fallToBottom();

            stopDragAnimation();

            stopIdleAnimation();
            
            // æ¢å¤å¾…æœºåŠ¨ç”»
            if (IMAGES.idleFrames.length > 0) {
                startIdleAnimation();
            }
        }

        function fallToBottom() {
            // ä½¿ç”¨åŠ¨ç”»å¹³æ»‘å è½
            const targetY = window.innerHeight - 100;
            const startY = petY;
            const startTime = Date.now();
            const duration = 600; // æ¯«ç§’

            function animate() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // ä½¿ç”¨ç¼“åŠ¨å‡½æ•°ï¼ˆease-out-bounceæ•ˆæœï¼‰
                const easeProgress = easeOutBounce(progress);
                
                petY = startY + (targetY - startY) * easeProgress;
                updatePetPosition();

                if (progress < 1) {
                    requestAnimationFrame(animate);
                }
            }

            animate();
        }

        // ç¼“åŠ¨å‡½æ•°ï¼šå¼¹è·³æ•ˆæœ
        function easeOutBounce(t) {
            const n1 = 7.5625;
            const d1 = 2.75;

            if (t < 1 / d1) {
                return n1 * t * t;
            } else if (t < 2 / d1) {
                return n1 * (t -= 1.5 / d1) * t + 0.75;
            } else if (t < 2.5 / d1) {
                return n1 * (t -= 2.25 / d1) * t + 0.9375;
            } else {
                return n1 * (t -= 2.625 / d1) * t + 0.984375;
            }
        }

        // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°å®šä½
        window.addEventListener('resize', () => {
            if (!isDragging) {
                petX = window.innerWidth / 2;
                petY = window.innerHeight - 100;
                updatePetPosition();
            }
        });

        // ==================== äº’åŠ¨èŠå¤©ç³»ç»Ÿ ====================

        // æ™®é€šå¯¹è¯å†…å®¹
        const chatDialogues = [
            "Whyyy click it??",
            "How's it going?",
            "I miss you... I mean, really",
            "Miss me?",
            "Please sleep earlier",
            "What are you thinking?",
            "You're my favorite",
            "I hope you're feeling well",
            "Yes baby?",
            "I'm sleepy, but I want to be with you",
            "...",
            "I think this is funny, you'll keep checking me instead of put down your phone",
            "Sometimes I wish you could talk to me more",
            "I don't have much time, so... I hope you like it",
            "I just want to make you happy",
            "I don't like chores",
            "*mad doggie image*",
            "I'm grateful you're here",
            "Kiss me",
            "Do you think it's silly?",
            "I like some oranges, apples are good too",
            "Don't drag me",
            "Yesterday I had a dream...",
            "It's happy to do something fun",
            "Do you think I'll know when you talk to me?",
            "I'm magical",
            "You're magical",
            "I want to play games with you",
            "Don't check the code, be polite!",
            "*pitiful doggie image*",
            "There's no secret here",
            "Bite you",
            "I'll be better",
            "New year is coming..."
        ];

        // å¸¦é€‰é¡¹çš„é—®é¢˜
        const questionDialogues = [
            {
                question: "Who are you thinking about?",
                options: [
                    { text: "You", response: "I knew it. I'm charming" },
                    { text: "someone else", response: "I knew it! You don't love me. I'll die soon" }
                ]
            },
            {
                question: "Are you mad at me?",
                options: [
                    { text: "Yes, very", response: "I'm sorry... I wish I didn't make you sad" },
                    { text: "A little", response: "I'm really sorry... Please Know I love you, I promise I'll change" },
                    { text: "No", response: "Gladly! I hope you really aren't mad, not just kindness" }
                ]
            },
            {
                question: "I've written a story with my former friend... What do you think is that about?",
                options: [
                    { text: "Alien", response: "No, but maybe I'll write one?" },
                    { text: "Zombie", response: "Yess, you can ask me about it now ~" }
                ]
            },
            {
                question: "What's your favorite animal?",
                options: [
                    { text: "Cat", response: "Good, you're the best!" },
                    { text: "Cat", response: "Maybe you like something else... But you can't choose them" },
                    { text: "Cat", response: "I'm so happy you know what to say" }
                ]
            },
            {
                question: "Will you talk to me soon?",
                options: [
                    { text: "I still need more time", response: "Okay... I'll wait. Please know I love you" },
                    { text: "Not now, but soon", response: "I see... Sorry... I miss you" },
                    { text: "I'll talk to you now", response: "Yesss! I was waiting for you because I love you" }
                ]
            },
            {
                question: "I asked you a lot, now you can ask me something",
                options: [
                    { text: "Do you afraid of ghosts?", response: "Yeah, just like I'm afraid of human" },
                    { text: "Do you really really like me?", response: "I do, really really" },
                    { text: "Do you like to eat fish?", response: "Some of them... Although I live near the ocean." }
                ]
            },
            {
                question: "Which doggie sticker is your favorite?",
                options: [
                    { text: "pitiful one", response: "Yeah, but sometimes it becomes sad..." },
                    { text: "mad one", response: "Yeah, it makes things less serious" },
                    { text: "cute one", response: "With or without heart? I love them too" }
                ]
            },
            {
                question: "Why you're still clicking this?",
                options: [
                    { text: "I'm bored", response: "Fine, I hope I'm not boring" },
                    { text: "No reason", response: "Good reason, really makes sense" },
                    { text: "I'm curious", response: "You're cute" }
                ]
            },
            {
                question: "Do you know what's my favorite cat?",
                options: [
                    { text: "Lioness", response: "True true! I love them!" },
                    { text: "Tiger", response: "I do love them, but they're kinda scary!" },
                    { text: "cheetah", response: "Almost! They're so so cute!" }
                ]
            },
            {
                question: "Do you like fruit candy or chocolate?",
                options: [
                    { text: "Fruit candy", response: "You know what I like ~" },
                    { text: "Chocolate", response: "That's really really good!" },
                ]
            }
            /*
                é—®é¢˜æ¨¡æ¿
            {
                question: "",
                options: [
                    { text: "", response: "" },
                    { text: "", response: "" },
                    { text: "", response: "" }
                ]
            },
            */
        ];

        let currentQuestion = null;
        let speechTimeout = null;

        // ç‚¹å‡»æ¡Œå® è§¦å‘å¯¹è¯
        petContainer.addEventListener('click', (e) => {
            // å¦‚æœä¸æ˜¯åœ¨æ‹–åŠ¨ï¼Œæ‰è§¦å‘
            if (!isDragging && e.target.closest('.speech-bubble') === null) {
                triggerChat();
            }
        });

        // ç‚¹å‡»èŠå¤©æŒ‰é’®
        const chatButton = document.getElementById('chatButton');
        chatButton.addEventListener('click', () => {
            triggerChat();
        });

        // è§¦å‘èŠå¤©
        function triggerChat() {
            // 20% æ¦‚ç‡å‡ºç°é—®é¢˜ï¼Œ80% æ¦‚ç‡æ™®é€šå¯¹è¯
            if (Math.random() < 0.2) {
                showQuestion();
            } else {
                showQuote(getRandomQuote(chatDialogues));
            }
        }

        // æ˜¾ç¤ºå¸¦é€‰é¡¹çš„é—®é¢˜
        function showQuestion() {
            currentQuestion = getRandomQuote(questionDialogues);
            
            // æ˜¾ç¤ºé—®é¢˜æ–‡å­—
            speechText.textContent = currentQuestion.question;
            speechBubble.classList.add('show');
            
            // åˆ›å»ºé€‰é¡¹æŒ‰é’®å®¹å™¨
            let optionsContainer = document.getElementById('optionsContainer');
            if (!optionsContainer) {
                optionsContainer = document.createElement('div');
                optionsContainer.id = 'optionsContainer';
                optionsContainer.className = 'options-container';
                //speechBubble.appendChild(optionsContainer);
                document.body.appendChild(optionsContainer);
            }
            
            // æ¸…ç©ºæ—§é€‰é¡¹
            optionsContainer.innerHTML = '';
            
            // åˆ›å»ºé€‰é¡¹æŒ‰é’®
            currentQuestion.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-button';
                button.textContent = option.text;
                button.onclick = () => handleOptionClick(option);
                optionsContainer.appendChild(button);
            });
            
            // æ˜¾ç¤ºé€‰é¡¹
            setTimeout(() => {
                optionsContainer.classList.add('show');
            }, 300);
        }

        // å¤„ç†é€‰é¡¹ç‚¹å‡»
        function handleOptionClick(option) {
            const optionsContainer = document.getElementById('optionsContainer');
            
            // éšè—é€‰é¡¹
            optionsContainer.classList.remove('show');
            
            // æ˜¾ç¤ºå›åº”
            setTimeout(() => {
                speechText.textContent = option.response;

                // é‡æ–°æ˜¾ç¤ºæ°”æ³¡
                speechBubble.classList.add('show');
                
                // æ¸…é™¤ä¹‹å‰çš„è®¡æ—¶å™¨
                if (speechTimeout) {
                    clearTimeout(speechTimeout);
                }
                
                // ä¿å­˜æ–°çš„è®¡æ—¶å™¨ï¼Œ5ç§’åéšè—å¯¹è¯æ¡†
                speechTimeout = setTimeout(() => {
                    speechBubble.classList.remove('show');
                }, 5000);
            }, 300);
        }

        // ä¿®æ”¹åŸæ¥çš„ showQuote å‡½æ•°ï¼Œç¡®ä¿éšè—é€‰é¡¹
        const originalShowQuote = showQuote;
        function showQuote(text) {
            // æ¸…é™¤ä¹‹å‰çš„è®¡æ—¶å™¨
            if (speechTimeout) {
                clearTimeout(speechTimeout);
            }
            
            // éšè—é€‰é¡¹ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer) {
                optionsContainer.classList.remove('show');
            }
            
            // æ˜¾ç¤ºæ™®é€šå¯¹è¯
            speechText.textContent = text;
            speechBubble.classList.add('show');
            
            // ä¿å­˜æ–°çš„è®¡æ—¶å™¨
            speechTimeout = setTimeout(() => {
                speechBubble.classList.remove('show');
            }, 4000);
        }

        // ==================== åˆå§‹åŒ– ====================
        
        window.addEventListener('load', () => {
            setupPetSprite();
            initPetPosition();
            
            setTimeout(() => {
                showQuote(getRandomQuote(startQuotes));
            }, 500);
        });
    </script>
</body>
</html>
